<%# include ../helper/breadcrumb.ejs %>
<% if(serchData.pdf_flag == 0){ %>
<style>

    .wrapperDoc-inner{ background:url(<%= site.fullUrl %>/images/imgpsh_fullsize_nc.jpg) repeat-y center center;  background-size:contain; padding: 20px;min-height:<%=serchData.no_pages%>px;}
    .clearfix:before, .clearfix:after{content: " ";display: table; box-sizing:border-box;}
    .clearfix:after {clear: both;}
    td, th { font-size: 8px; line-height: 12px;}
    span{font-size: 8px  ; line-height: 12px;  }
    div,strong,li,ul,ol{ line-height: 12px;}
    strong{ font-weight: 400; color: #000}
    .wrapperDoc {margin: 0 auto;max-width: 990px;padding:15px 15px;font-family: Verdana,Geneva,sans-serif;font-size:8px;line-height: 15px;
                 /*color: #555555;*/
    }
    strong { font-weight:600;}
    .headingtxt {text-align:center; margin-bottom:5px; font-weight:400;font-size:10px;}
    .header .left .headingtxt { text-align: left;}
    .header .left .headingtxt span{ font-weight:300; font-size: 7px; display: block; max-width: 200px; line-height: 10px;color:#000}
    .headingtxt.mid{ padding: 7px 0; color: #333; margin-top:5px}
    .trd-mid{ padding:0px 0; color: #333; margin-bottom:0px;  margin-top:0px}
    .print-date { text-align:right;}
    .print-date span {display:inline-block;margin-right:10px;font-size:8px;font-weight:400;}
    .main-table td {padding:1px 3px;vertical-align:top}
    .main-table {width:100%;margin-top:0px;}
    .main-table td span {display:block; }
    .text-right { text-align:right}
    .text-left {text-align:left}
    .bold-txt {font-weight:500;}
    .text-center {text-align:center}
    .benificary-table{ margin-top:0px; width:100%}
    .benificary-table td {padding:1px 3px;vertical-align:top}
    .benificary-table td span {display:block; }
    .big-text{ font-size:10px;}
    .thankmsg{ font-size:8px; text-align:center; margin-top:10px;}
    .thankmsg span{ display:block;line-height: 13px; margin-bottom: 6px;}

    /*new*/


    .party-block{ clear: both; padding-top: 10px;  margin-bottom:10px;}
    p{ margin-bottom: 0;}
    .party-block p{ margin-bottom: 0px;}
    .party-block p{ margin-top:0px;}
    .party-block .benificary-table{ width:50%; float: left;}
    .party-block .benificary-table:nth-child(even){ margin-right: 0;}
    .party-block .benificary-table:nth-child(even) tr td:nth-child(odd){ background: none;}
    .party-block .benificary-table:nth-child(odd) tr td:nth-child(odd){ background: none;}
    #Party-2.benificary-table tr td:first-child{border-left:none;}

    .benificary-table.terms ul {list-style: decimal inside none;color: #555; margin-bottom:0px;}
    .benificary-table.terms ul li{ padding:1px 3px; border-bottom: thin solid #f0efef;}
    .benificary-table.terms ul li span{ display: inline-block;}
    .benificary-table.terms ul li:last-child{ padding-bottom: 0; border-bottom: none}
    .benificary-table.terms ul{ padding-left: 0;}
    .benificary-table.terms td{ padding: 0}
    .benificary-table.terms td:first-of-type{width: 10px;}
    .benificary-table.terms tr:first-child{background:none}
    .benificary-table.terms .terms-txt span{ padding:1px 3px;}
    .header .left{ float: left; width:40%; text-align:left;}
    .header .left >div{ display: inline-block;; margin-right: 10px; vertical-align: middle;}
    .header .right{ float: right; width: 40%;  text-align: right;}
    .header .right span{line-height: 11px;}
    .thankmsg a{ color: #333333}
    .footer > div{ display: inline-block; vertical-align: bottom; width: 49%}
    .footer-left span{ display: block;}
    .footer-right{ text-align: right;}

    .exemptionWrap{ margin-top:10px; margin-bottom:0px;color: #555}
    .exemptionWrap table tr:first-child{background: none; padding: 5px;}
    .exemptionWrap table tr td{ padding:1px 3px; text-align: left;
                                /*color: #555*/
    }
    /*.main-tableWrap table.main-table{ width: 100% ;float: none; height: auto}*/

    .main-tableWrap table.main-table:nth-child(odd){ margin-right:0;}
    .main-tableWrap table.main-table:nth-child(odd) tr td:nth-child(odd){ background: none; }
    .main-tableWrap table.main-table:nth-child(even) tr td:nth-child(odd){ background: none;}
    .table-bordered>tbody>tr>td, .table-bordered>tbody>tr>th, .table-bordered>tfoot>tr>td, .table-bordered>tfoot>tr>th, .table-bordered>thead>tr>td, .table-bordered>thead>tr>th{ border:thin solid #000000}
    .table-bordered{border-collapse: collapse;}
    /*.main-tableWrap table.main-table tr td:nth-child(odd), .benificary-table tr td:nth-child(odd) span{ text-transform: lowercase;}*/
    .main-tableWrap table.main-table tr td:nth-child(odd):first-letter,.benificary-table tr td:nth-child(odd) span:first-letter{ text-transform: uppercase;}

    .header{ text-align:center;}
    .mainlogo{ text-align:center; margin:0px auto; width:25%;margin-bottom: 20px;}
    .sub-heading{border: 1px solid #000; padding: 2px 10px;}
    .td-width2{width: 100px !important;}
    .td-width1{width: 100px !important;}
    .td-middle-width{vertical-align: middle !important; width: 15px !important;}
    .text-center{text-align: center;}
    .individual-block{padding-top: 5px; width: 100%;clear: both;}
    .individual-block p{margin-bottom: -15px;}
    .individual-block table{padding-top: 0px;}
    .offset-top-35{margin-top: 15px;}
    .offset-top-50{margin-top: 25px;}
    .offset-top-10{margin-top: 10px;}
    .offset-top-20{margin-top: 10px;}
    .footer > .fee-info {width: 100%;}
    .footer-text-right .text-right{
        display: block;
    }
    .tabale-col2 { width: 50%; float:left; margin-bottom: 10px; }
    .table-outer .tabale-col2:nth-child(2n+1) { clear:left; }
    .notDisplayClass{display: block;}
    tr.align-left-pdf {
        text-align: left;
    }
</style>

<% } %>
<div class="wrapperDoc" >
    <div class="wrapperDoc-inner">
        <div class="header clearfix notDisplayClass hide">
            <div class="left">
                <div class="headingtxt"> NATIONAL ARBITRAL TRIBUNAL <span style='color:#000'>(An Permanent Arbitral Institute constituted under the provision of Arbitration and Conciliation Act, 1996)</span> </div>
            </div>
            <div class="right">
                <div><span>Legal Resolution Centre Pvt. Ltd.</span></div>
                <div><span>Head Office: <%= settingData.head_office %></span></div>
                <div><span>Website: <%= settingData.website %></span></div>
                <div><span>Email: <%= settingData.email %></span></div>
                <div><span>contact: <%= settingData.phone %></span></div>
                <div><span>PAN: <%= settingData.head_pan_number %></span></div>
                <div><span>GSTIN: <%= settingData.gstin_no %></span></div>

            </div>
            <div class="mainlogo"><img src="<%= site.fullUrl %>/images/nat_logo_round.png"  style="height:70px; width:auto; vertical-align:middle"></div>
            <div><h3>Incentive & TDS Statement
                    <% if(serchData.start_date!=''){ %>
                    from
                    <% } %>
                    <%= serchData.start_date%>
                    <% if(serchData.end_date!=''){ %>
                    to
                    <% } %>
                    <%= serchData.end_date%>
                </h3></div>
        </div>

        <section class="content">

            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">

                                Incentive Details

                            </h3>
                        </div>
                        <div class="box-header with-border notDisplayClass hide">
                            <div>
                                <span class="box-title" style="font-size: 9px;">To:<%= locals.loginUser.first_name %></span>
                            </div>
                            <div>
                                <span class="box-title"  style="font-size: 9px;">Address:<%= locals.loginUser.residence_address %>, <% if(results[0] && typeof results[0].district_name != 'undefined'){ %> <%= results[0].district_name %> <% } %>
                                </span>
                            </div>
                            <div>
                                <span class="box-title"  style="font-size: 9px;">ID:<%= locals.loginUser.gid %></span>
                            </div>
                            <div>
                                <span class="box-title"  style="font-size: 9px;">PAN:
                                    <% if(locals.loginUser.user_bank_details){ %>
                                    <%= locals.loginUser.user_bank_details.pan_no %>
                                    <% } %>
                                </span>
                            </div>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">

                            <% if(loginUser['active_commission']==0){ %>
                            <div class="callout callout-danger">
                                <h5>Your Commission is disabled by Admin</h5>
                            </div>
                            <% } %>
                            <% if(serchData.pdf_flag != 0){ %>
                            <form action="/admin/commission_distributions/my_commission" method="get" name="serchFrom" role="form">
                                <input type="submit" class="btn btn-success blue" style="display:none">
                                <div class="form-row-new row">
                                    <div class="col-md-3">
                                        <div class="form-group"><input type="text" name="start_date" placeholder="Start Date" id="start_date" class="form-control startdate" value="<%= serchData.start_date %>"></div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group"><input type="text" value="<%= serchData.end_date %>" name="end_date" placeholder="End Date" id="end_date" class="form-control enddate"></div>
                                    </div>
                                    <% if(loginUser.user_type.user_role.role_slug == 'franchise' && loginUser['franchise_level']!='tehsil_level'){ %>
                                    <div class="col-md-2">
                                        <div class="form-group custom-select-outer">

                                            <select id="type" name="type" class="form-control select2" tabindex="-1" aria-hidden="true">
                                                <option value="">Select</option>
                                                <option value="0" <% if(serchData.type && serchData.type==0){ %>selected<% } %>>Nyaya Card</option>
                                                <% if(locals.loginUser.user_type.role_type_slug != 'stamp_vendor'){ %>
                                                <option value="1" <% if(serchData.type && serchData.type==1){ %>selected<% } %>>Membership</option>
                                                <% } %>

                                            </select>

                                        </div>
                                    </div>



                                    <div class="col-md-2">
                                        <div class="form-group"><input type="text" value="<%= serchData.invoice_no %>" name="invoice_no" placeholder="Invoice No." id="invoice_no" class="form-control"></div>
                                    </div>


                                    <div class="col-md-2">
                                        <div class="form-group"><input type="text" value="<%= serchData.stamp_no %>" name="stamp_no" placeholder="Stamp No." id="stamp_no" class="form-control"></div>
                                    </div>


                                    <% } %>
                                    <div class="col-md-6 form-small-btn">
                                        <a title="search" href="javascript:document.serchFrom.submit()" class="btn btn-success blue mr-5">
                                            <i class="fa fa-search"></i>
                                        </a>
                                        <a title="Clear Search" href="/admin/commission_distributions/my_commission" class="btn btn-success blue">Clear Search</a>

                                        <a target="_blank" href="/admin/commission_distributions/incentive_download?start_date=<%=serchData.start_date%>&end_date=<%=serchData.end_date%>&pdf_flag=0" class="btn btn-primary pull-right dwnPdfClass" style="margin-right:2px">Download PDF</a>
                                    </div>
                                </div>
                            </form>

                            <% } %>

                            <div class="main-tableWrap clearfix">
                                <div class="table-responsive">
                                    <table class="table table-bordered main-table table-bordered offset-top-20">
                                        <tr>
                                            <% if(serchData.pdf_flag == 0){ %>
                                            <th>S.No.</th>
                                            <% } %>
                                            <th>Date</th>
                                            <th>Stamp No.</th>
                                            <th>Invoice No.</th>
                                            <% if(loginUser['user_type']['role_type_slug']!='stamp_vendor'){ %>
                                            <th>Document Number</th>
                                            <% } %>

                                            <th>Incentive</th>


                                            <% if(loginUser['user_type']['role_type_slug']!='stamp_vendor'){ %>
                                            <th>Additional Incentive</th>
                                            <% } %>
                                            <% if(serchData.pdf_flag != 0){ %>
                                            <% if(loginUser['user_type']['role_type_slug']=='stamp_vendor'){ %>
                                            <th>Penalty</th>
                                            <% } %>
                                            <% } %>
                                            <th>Total Incentive</th>


                                            <th>TDS</th>
                                            <th>Payable Incentive</th>

                                            <!--                            <th>Invoice amount with Tax</th>
                                                                        <th>Invoice amount without Tax</th>
                                                                        <th>Tax</th>-->

                                            <th>Status</th>

                                        </tr>

                                        <% var countRe = 1;%>
                                        <%
                                        var total_commission_amount = 0;
                                        var total_bonus_commission_amount = 0;
                                        var total_penalty = 0;
                                        var total_incentive = 0;
                                        var total_tds = 0;
                                        var total_payble_commission = 0;

                                        results.forEach(function(rows){ %>


                                        <tr>
                                            <% if(serchData.pdf_flag == 0){ %>
                                            <td><%= countRe %></td>
                                            <% } %>
                                            <td><%= site.momentObj(rows.added_date).format('DD-MM-YYYY') %></td>
                                            <td>
                                                <%= rows.stamp_number %>
                                            </td>
                                            <td>
                                                <%= rows.invoice_no %>
                                            </td>
                                            <% if(loginUser['user_type']['role_type_slug']!='stamp_vendor'){ %>
                                            <td>
                                                <% if(rows.membership_plan_issue_id){ %>
                                                M. No. :   <%= rows.ms_id %>
                                                <% } %>
                                                <% if(rows.arbitration_agreements_id){ %>
                                                NC No. :   <%= rows.ar_id %>
                                                <% } %>
                                            </td>
                                            <% } %>
                                            <td>
                                                <%= rows.commission_amount %>

                                            </td>
                                            <%
                                            var totalAmu=parseFloat(rows.commission_amount)+parseFloat(rows.bonus_commission_amount);
                                            var chkAmu=(totalAmu*parseFloat(rows.commission_tds_rate))/100
                                            %>
                                            <% if(loginUser['user_type']['role_type_slug']!='stamp_vendor'){ %>
                                            <td>
                                                <% if(parseFloat(chkAmu).toFixed(2) > rows.commission_tds && rows.bonus_commission_amount != 0){ %>- <% } %>
                                                <%= rows.bonus_commission_amount %>
                                            </td>
                                            <% } %>
                                            
                                            <% if(serchData.pdf_flag != 0){ %>
                                            <% if(loginUser['user_type']['role_type_slug']=='stamp_vendor'){ %>
                                            <td><%= rows.penalty %></td>
                                            <% } %>
                                            <% } %>
                                            <td><b>
                                                    <% var netAmu=rows.final_commission+rows.commission_tds; %>
                                                    <%= parseFloat(netAmu).toFixed(2) %>
                                                </b>
                                            </td>

                                            <td><%= rows.commission_tds %></td>
                                            <td><b><%= rows.final_commission %></b></td>

                                            <!--                            <td>
                                                                            <%# rows.total_fees %>
                                                                        </td>

                                                                        <td>
                                                                            <%# rows.commission_base_amount %>
                                                                        </td>

                                                                        <td><%# rows.tax %></td>
                                            -->






                                            <td>
                                                <% if(rows.membership_plan_issue_id){ %>
                                                <span class="label label-success">Mature</span>
                                                <% }else{ %>
                                                    <% if(rows.ar_status==1){ %>

                                                        <% if(loginUser['user_type']['role_type_slug']=='stamp_vendor'){ %>
                                                            <% if(rows.cd_paid==0){ %>
                                                                <span class="label label-danger">Pending</span>
                                                            <% }else{ %>
                                                                <span class="label label-success">Mature</span>
                                                            <% } %>
                                                        <% }else{ %>
                                                            <span class="label label-success">Mature</span>
                                                        <% } %>

                                                    <% } else if(rows.ar_status==3){ %>
                                                        <span class="label label-success">Mature With Credits</span>
                                                    <% }else{ %>
                                                        <span class="label label-info">Freezed</span>
                                                    <% } %>
                                                <% } %>
                                            </td>

                                            <% countRe++ ;%>
                                            <%
                                            <!--#Incentive-->
                                            total_commission_amount = parseFloat(total_commission_amount) + parseFloat(rows.commission_amount);

                                            <!--#Additional Incentive-->
                                            var totalAmu=parseFloat(rows.commission_amount)+parseFloat(rows.bonus_commission_amount);
                                            var chkAmu=(totalAmu*parseFloat(rows.commission_tds_rate))/100
                                            if(parseFloat(chkAmu).toFixed(2) > rows.commission_tds && rows.bonus_commission_amount != 0){
                                            total_bonus_commission_amount = parseFloat(total_bonus_commission_amount) - parseFloat(rows.bonus_commission_amount);
                                            } else {
                                            total_bonus_commission_amount = parseFloat(total_bonus_commission_amount) + parseFloat(rows.bonus_commission_amount);
                                            }

                                            <!--#Penalty-->
                                            total_penalty = parseFloat(total_penalty) + parseFloat(rows.penalty);

                                            <!--#Total Incentive-->
                                            total_incentive = parseFloat(total_incentive) + parseFloat(netAmu);

                                            <!--#TDS-->
                                            total_tds = parseFloat(total_tds) + parseFloat(rows.commission_tds);

                                            <!--#Payable Incentive-->
                                            total_payble_commission = parseFloat(total_payble_commission) + parseFloat(rows.final_commission);
                                            %>
                                        </tr>
                                        <% }); %>

                                        <% if(results.length > 0){ %>
                                        <tr class="noSerialNo th align-left-pdf">
                                            <% if(serchData.pdf_flag == 0){ %>
                                            <th>&nbsp;</th>
                                            <% } %>
                                            <th>&nbsp;</th>
                                            <th>&nbsp;</th>
                                            <th>&nbsp;</th>
                                            <% if(loginUser['user_type']['role_type_slug']!='stamp_vendor'){ %>
                                            <th>&nbsp;</th>
                                            <% } %>

                                            <th><%= total_commission_amount.toFixed(2) %></th>


                                            <% if(loginUser['user_type']['role_type_slug']!='stamp_vendor'){ %>
                                            <th><%= total_bonus_commission_amount.toFixed(2)%></th>
                                            <% } %>
                                            
                                            <% if(serchData.pdf_flag != 0){ %>
                                            <% if(loginUser['user_type']['role_type_slug']=='stamp_vendor'){ %>
                                            <th><%=total_penalty.toFixed(2) %></th>
                                            <% } %>
                                            <% } %>
                                            <th><%=total_incentive.toFixed(2)%></th>


                                            <th><%=total_tds.toFixed(2)%></th>
                                            <th><%=total_payble_commission.toFixed(2)%></th>
                                            <th>&nbsp;</th>

                                        </tr>
                                        <% } %>
                                    </table>
                                </div>
                            </div>

                            <% if(results.length==0){ %>
                            <h5 class="box-header text-center">No record found</h5>
                            <% } %>

                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer clearfix">

                            <%# include ../helper/page2.ejs %>




                        </div>
                    </div>

                </div>

                <div class="box-footer">
                    <div class="row">
                        <div class="col-md-12 text-right">
                            <%- include ../helper/pagination.ejs %>
                        </div>
                    </div>
                </div>

                <!-- /.col -->
            </div>
        </section>
    </div>
</div>
<% if(serchData.pdf_flag != 0){ %>
<script>
    $('.startdate').datepicker({
        format: 'dd-mm-yyyy',
        //startDate: '-d',
        todayHighlight: true,
        autoclose: true

    });
    $('.enddate').datepicker({
        format: 'dd-mm-yyyy',
        //startDate: '-d',
        todayHighlight: true,
        autoclose: true,
    });
    var tableHeight = parseFloat($(".table-bordered").height()) + 170;
    var NoPages = Math.round((parseFloat(tableHeight) / parseInt(720)));

    var ogNo = (parseFloat(tableHeight) / parseInt(720));

    var diff = ogNo - NoPages;

    if (diff > 1.8) {
        NoPages = Math.ceil(ogNo)
    }

    var finalHeight = (NoPages * parseInt(720));

    $(document).on('click', '.dwnPdfClass', function (e) {
        e.preventDefault();
        var newUrl = $(this).attr('href') + '&no_pages=' + finalHeight;
        console.log(newUrl, tableHeight, NoPages)
        window.open(newUrl, '_blank');
    });
</script>
<% } %>
